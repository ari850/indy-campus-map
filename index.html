<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Indy Campus Map</title>
  <style>
    body { margin:0; font-family: system-ui, Arial, sans-serif; }
    #campus { max-width:100%; height:auto; display:block; }
    area { cursor:pointer; }
    #lightbox { position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.6); z-index:9999; padding:24px; }
    #lightbox[aria-hidden="false"] { display:grid; }
    .lb-card { background:#fff; border-radius:14px; max-width:min(900px,92vw); width:fit-content; max-height:82vh; overflow:auto; box-shadow:0 10px 30px rgba(0,0,0,.3); }
    .lb-head{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-bottom:1px solid #eee}
    .lb-head h2{margin:0;font-size:16px;font-weight:600}
    .lb-close{border:0;background:transparent;font-size:22px;line-height:1;cursor:pointer;padding:4px 8px}
    .lb-body{padding:10px 14px 16px}
    .lb-body img{max-width:100%;height:auto;display:block;border-radius:10px}
    .lb-cap{margin:10px 2px 2px;color:#444;font-size:14px}
    .lb-error{margin:10px 2px;color:#b00020;font-size:14px;display:none}
  </style>
</head>
<body>

<img id="campus" src="Indy_Campus_Map.png" usemap="#image-map" alt="Purdue Indianapolis map" decoding="async">

<map name="image-map">
  <!-- Keep your original LUX rectangle (already works) -->
  <area
    shape="rect"
    coords="4620,1210,4760,1350"
    alt="LUX on Capitol"
    title="LUX on Capitol"
    href="#"
    data-img="LUX_pic.jpg"
    data-caption="LUX on Capitol — residence hall &amp; apartments on North St.">

  <!-- Image Map Generator output: left UNTOUCHED (uses x,y only).
       The script below will turn these into small circles and use href as the image if data-img is missing. -->
  <!-- Image Map Generated by http://www.image-map.net/ -->
  <area target="_blank" alt="Student Center" title="Student Center" href="SC.jpg" coords="3664,1318" shape="rect">
  <area target="_blank" alt="Academic Success Building" title="Academic Success Building" href="ASB.jpg" coords="3330,1350" shape="rect">
  <area target="_blank" alt="Informatics &amp; Communications Technology Complex" title="Informatics &amp; Communications Technology Complex" href="IT.jpg" coords="3346,1556" shape="rect">
  <area target="_blank" alt="Innovation Hall" title="Innovation Hall" href="IO.jpg" coords="3102,1528" shape="rect">
  <area target="_blank" alt="Purdue Campus Connect Shuttle" title="Purdue Campus Connect Shuttle" href="bus.jpg" coords="3102,1894" shape="rect">
  <area target="_blank" alt="STT" title="STT" href="STT.jpg" coords="3404,1066" shape="rect">
  <area target="_blank" alt="Engineering Science &amp; Technology Building" title="Engineering Science &amp; Technology Building" href="SL_LD.jpg" coords="2789,1512" shape="rect">
  <area target="_blank" alt="Science Building" title="Science Building" href="SL_LD.jpg" coords="2832,1685" shape="rect">
  <area target="_blank" alt="Science &amp; Engineering Laboratory Building" title="Science &amp; Engineering Laboratory Building" href="EL.jpg" coords="2821,1889" shape="rect">
  <area target="_blank" alt="University Library" title="University Library" href="Library.jpg" coords="2545,1755" shape="rect">
  <area target="_blank" alt="Engineering Technology Building" title="Engineering Technology Building" href="ET_bldg.jpg" coords="2487,1525" shape="rect">
  <area target="_blank" alt="North Hall" title="North Hall" href="North_Hall.jpg" coords="2487,951" shape="rect">
  <area target="_blank" alt="Hine Hall" title="Hine Hall" href="Hine_Hall.jpg" coords="2227,1223" shape="rect">
  <area target="_blank" alt="Taylor Hall" title="Taylor Hall" href="Taylor_hall.jpg" coords="2201,1729" shape="rect">
  <area target="_blank" alt="Education Social Work Building" title="Education Social Work Building" href="ES.png" coords="2158,1995" shape="rect">
  <area target="_blank" alt="Lecture Hall" title="Lecture Hall" href="Lecture_hall.jpg" coords="1984,1810" shape="rect">
  <area target="_blank" alt="Cavanaugh Hall" title="Cavanaugh Hall" href="Cavanaugh_hall.jpg" coords="1994,1593" shape="rect">
  <area target="_blank" alt="Campus Ceneter" title="Campus Ceneter" href="Campus_center.jpg" coords="1787,1539" shape="rect">
</map>

<div id="lightbox" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="lb-card" role="document">
    <div class="lb-head">
      <h2 id="lb-title">Title</h2>
      <button class="lb-close" aria-label="Close">×</button>
    </div>
    <div class="lb-body">
      <img id="lb-img" alt="">
      <p id="lb-error" class="lb-error"></p>
      <p id="lb-cap" class="lb-cap"></p>
    </div>
  </div>
</div>

<script>
  (function () {
    const DEFAULT_RADIUS = 70; // hotspot size in ORIGINAL image pixels

    const img = document.getElementById('campus');
    const mapName = img.useMap ? img.useMap.replace('#','') : '';
    const map = document.querySelector('map[name="' + mapName + '"]');
    if (!map) return;
    const areas = Array.from(map.querySelectorAll('area'));

    // 1) Normalize: turn "x,y" into "x,y,r" circles; remember originals for scaling
    function normalizeAreas() {
      areas.forEach(a => {
        const raw = (a.coords || '').split(',').map(n => Number(n.trim())).filter(n => !Number.isNaN(n));
        if (raw.length === 2) {
          const [x, y] = raw;
          a.shape = 'circle';
          a.coords = [x, y, DEFAULT_RADIUS].join(',');
        }
        if (!a.dataset.originalCoords) a.dataset.originalCoords = a.coords;
      });
    }

    // 2) Scale coords to rendered size
    function scaleAreas() {
      const naturalW = img.naturalWidth || img.width;
      if (!naturalW) return;
      const scale = img.clientWidth / naturalW;
      areas.forEach(a => {
        const scaled = a.dataset.originalCoords.split(',').map(Number).map(v => Math.round(v * scale));
        a.coords = scaled.join(',');
      });
    }

    if (img.complete) { normalizeAreas(); scaleAreas(); }
    else { img.addEventListener('load', () => { normalizeAreas(); scaleAreas(); }); }
    window.addEventListener('resize', scaleAreas);

    // 3) Lightbox wiring with fallback to href if data-img is missing
    const lb = document.getElementById('lightbox');
    const lbImg = document.getElementById('lb-img');
    const lbTitle = document.getElementById('lb-title');
    const lbCap = document.getElementById('lb-cap');
    const lbErr = document.getElementById('lb-error');
    const closeBtn = document.querySelector('.lb-close');

    function openLB(src, title, cap) {
      lbErr.style.display = 'none';
      lbErr.textContent = '';
      lbImg.onerror = () => {
        lbErr.textContent = 'Could not load image: ' + src;
        lbErr.style.display = 'block';
        console.error('Lightbox image failed to load:', src);
      };
      lbImg.src = src;
      lbImg.alt = title || '';
      lbTitle.textContent = title || '';
      lbCap.textContent = cap || '';
      lb.setAttribute('aria-hidden','false');
      document.documentElement.style.overflow = 'hidden';
    }
    function closeLB() {
      lb.setAttribute('aria-hidden','true');
      lbImg.src = '';
      document.documentElement.style.overflow = '';
    }
    closeBtn.addEventListener('click', closeLB);
    lb.addEventListener('click', e => { if (e.target === lb) closeLB(); });
    document.addEventListener('keydown', e => { if (e.key === 'Escape') closeLB(); });

    areas.forEach(a => {
      a.addEventListener('click', e => {
        // Use data-img if present; otherwise fall back to href
        const src = a.dataset.img || a.getAttribute('href');
        if (!src || src === '#') return; // nothing to show
        e.preventDefault(); // stop navigation; show lightbox instead
        openLB(src, a.title || a.alt, a.dataset.caption || '');
      });
    });
  })();
</script>
</body>
</html>
